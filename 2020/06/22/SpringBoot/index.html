<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        
    
    <link rel='stylesheet' href="/./css/dracula.css">

        <title>Spring Boot 学习</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2.0">
<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="manifest" href="/site.webmanifest">

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <header class="al_header al_pos_fixed">
    <div class="al_header_container dis_flex_jcenter">
        <div class="al_header_container_left">
            <div class="al_header_site_title">
                <a href="/">Joker Won's Stack</a>
            </div>
        </div>

        <div class="dis_flex_jcenter">
            <div class="al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-menu"></use>
                </svg>
            </div>
        </div>
    </div>
</header>

        <div class="al_sidebar">

    <div class="al_sidebar_overlay al_full_cover"></div>

    <div class="al_pos_fixed al_sidebar_cnt">
        <div class="dis_flex_acenter al_sidebar_header">
            <h3>Joker Won's Stack</h3>
            <div class="al_sidebar_close al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-close"></use>
                </svg>
            </div>
        </div>

        <div class="al_sidebar_author_cnt">

            <div class="al_sidebar_author_info">
                <h4>Joker Won</h4>
                <img class="al_sidebar_avatar" src="https://cdn.jsdelivr.net/gh/jokerwon/images/img/avatar.jpg">
                <p>OS 出身的小伙子，对 Objective-C、Swift、以及 Javascript 有浓厚的兴趣。热衷使用原生实现所有功能，厌恶一切的跨平台开发技术。喜欢分享工作过程中遇到的问题以及日常工作中遇到的新技术。希望这个博客能给你带来一点启发。</p>
            </div>

            
        </div>
    </div>
</div>

        
    <div class="dis_flex_center al_lightbox_cnt al_full_cover">
        <img class="al_lightbox_img"/>
    </div>
    <div class="al_page_background dis_flex_center al_full_cover"></div>
    <div class="al_page_container">
        <div class="al_pos_ab al_fake_background"></div>
        <div class="al_main_container al_shadow al_main_page_container">
            <article class="al_article">
                <header>
                    <h1 class="al_page_title">
                        Spring Boot 学习
                    </h1>
                    <div class="al_page_info dis_flex">
                        <div class="al_page_content_info">
                            Mon June 22, 2020 01:03 AM
                        </div>

                        

                        
                        <span class="tags"></span>
                    </div>
                </header>

                
                    <div class="al_page_content_outline">
                        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-IOC"><span class="toc-text">一、 IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BD%BF%E7%94%A8%E5%B1%9E%E6%80%A7%E7%9A%84-setter-%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-text">1.1  使用属性的 setter 方法注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="toc-text">1.2  使用构造函数注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5"><span class="toc-text">1.3  使用注解注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E4%BB%8E-IOC-%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%8E%B7%E5%BE%97-Bean"><span class="toc-text">1.4  从 IOC 容器中获得 Bean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-AOP"><span class="toc-text">二、 AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">2.1  相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E7%A1%AE%E5%AE%9A%E8%BF%9E%E6%8E%A5%E7%82%B9"><span class="toc-text">2.2  确定连接点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%BC%80%E5%8F%91%E5%88%87%E9%9D%A2"><span class="toc-text">2.3  开发切面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%B5%8B%E8%AF%95-AOP"><span class="toc-text">2.4  测试 AOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="toc-text">2.5  环绕通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E9%80%9A%E7%9F%A5%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"><span class="toc-text">2.6  通知获取参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-%E5%A4%9A%E4%B8%AA%E5%88%87%E9%9D%A2"><span class="toc-text">2.7  多个切面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-MyBatis-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">三、 MyBatis 操作数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">3.1  配置自定义数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-MyBatis-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">3.2  MyBatis 基础操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-MyBatis-%E8%BF%9B%E9%98%B6"><span class="toc-text">3.3  MyBatis  进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-resultMap-%E8%A1%A8%E5%85%B3%E8%81%94"><span class="toc-text">3.3.1  resultMap 表关联</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-%E5%8A%A8%E6%80%81-SQL"><span class="toc-text">3.3.2  动态 SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-Web-%E7%9B%B8%E5%85%B3"><span class="toc-text">四、 Web 相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Controller-%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0"><span class="toc-text">4.1  Controller 接收参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-1-%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">4.1.1  请求路径参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-2-Body-%E5%8F%82%E6%95%B0"><span class="toc-text">4.1.2  Body 参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-3-%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%8F%82%E6%95%B0%E5%8F%8A-Cookie"><span class="toc-text">4.1.3  请求头参数及 Cookie</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%BF%94%E5%9B%9E-JSON-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text">4.2  返回 JSON 数据格式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-%E9%80%9A%E8%BF%87-ResponseBody"><span class="toc-text">4.2.1  通过@ResponseBody</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-2-%E9%80%9A%E8%BF%87HttpServletResponse%E6%9D%A5%E8%BF%94%E5%9B%9E"><span class="toc-text">4.2.2  通过HttpServletResponse来返回</span></a></li></ol></li></ol></li></ol>
                    </div>
                

                
                <section id="post-body">
                    <p><strong>学学Spring Boot</strong></p>
<span id="more"></span>

<h3 id="一、-IOC"><a href="#一、-IOC" class="headerlink" title="一、 IOC"></a>一、 IOC</h3><h4 id="1-1-使用属性的-setter-方法注入"><a href="#1-1-使用属性的-setter-方法注入" class="headerlink" title="1.1  使用属性的 setter 方法注入"></a>1.1  使用属性的 setter 方法注入</h4><p>代码1-1</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- xml配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.znv.study.pojo.Car&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Benz&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">value</span>=<span class="string">&quot;600000.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxSpeed&quot;</span> <span class="attr">value</span>=<span class="string">&quot;240&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 引用其他 bean --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 通过 ref 属性或者 &lt;ref&gt; 标签引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;master&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;master&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;master&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;master&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 通过内部 bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;master&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.znv.study.pojo.Master&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;joker&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;master&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.znv.study.pojo.Master&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;joker&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.pojo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSpeed;</span><br><span class="line">    <span class="keyword">private</span> Master master;  <span class="comment">//拥有者 Bean</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//无参构造方法，required</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"> <span class="comment">/*  setter(required)  */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.znv.study.pojo</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Master</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Master</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">/*  setter(required)  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>使用 setter 注入，Bean 中必需有无参的构造方法和 setter 方法</em></p>
<h4 id="1-2-使用构造函数注入"><a href="#1-2-使用构造函数注入" class="headerlink" title="1.2  使用构造函数注入"></a>1.2  使用构造函数注入</h4><p>代码1-2</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- xml配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.znv.study.Car&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">contructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;Benz&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">contructor-arg</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过指定类型 type 来区分不同的参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;600000.0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">contructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;240&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">contructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.pojo</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSpeed;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//参数对应的构造方法(required)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String brand, <span class="type">double</span> price, <span class="type">int</span> maxSpeed)</span>&#123;</span><br><span class="line">     <span class="built_in">this</span>.brand = brand;</span><br><span class="line">     <span class="built_in">this</span>.price = price;</span><br><span class="line">     <span class="built_in">this</span>.maxSpeed = maxSpeed;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-使用注解注入"><a href="#1-3-使用注解注入" class="headerlink" title="1.3  使用注解注入"></a>1.3  使用注解注入</h4><p>代码1-3</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.pojo</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component(&quot;car&quot;)</span>  <span class="comment">//注册 Bean，且命名为car</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span>  <span class="comment">//修改 Bean 的作用域为原型，默认为单例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;Benz&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="meta">@Value(&quot;600000.0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="meta">@Value(&quot;240&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSpeed;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Master master;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*  setter and getter  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​ 假如代码 1-3 中的Master指代不明确，可以用 @Primary 为希望使用的 Bean 注解，或者用 @Qualifier(“…”) 在成员上注解，以用来消除歧义性。</p>
<p>配置类AppConfig</p>
<p>代码1-4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.configuration</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//定义该类为配置类</span></span><br><span class="line"><span class="meta">@ComponentScan</span>  <span class="comment">//定义扫描的包，默认为当前包及子包</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppConfig</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-从-IOC-容器中获得-Bean"><a href="#1-4-从-IOC-容器中获得-Bean" class="headerlink" title="1.4  从 IOC 容器中获得 Bean"></a>1.4  从 IOC 容器中获得 Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study</span><br><span class="line"><span class="keyword">import</span> com.znv.study.pojo.Car</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> (Car) ctx.getBean(<span class="string">&quot;car&quot;</span>);</span><br><span class="line">        System.out.println(car);</span><br></pre></td></tr></table></figure>

<h3 id="二、-AOP"><a href="#二、-AOP" class="headerlink" title="二、 AOP"></a>二、 AOP</h3><h4 id="2-1-相关概念"><a href="#2-1-相关概念" class="headerlink" title="2.1  相关概念"></a>2.1  相关概念</h4><ul>
<li>连接点（joint  point）: 对应的是具体被拦截的对象。因为 Spring 只能支持方法，所以被拦截的对象往往指特定的方法。</li>
<li>切点（point  cut）： 目标对象，<em>已经增强的方法</em>。</li>
<li>通知（advice）： 增强的代码。分为前置通知（before advice）、后置通知（after advice）、环绕通知（around advice）、事后返回通知（after-returning advice）和异常通知（after-throwing advice）。会根据约定织入流程中。</li>
<li>目标对象（target）： 被代理的对象。</li>
<li>织入（weaving）： 将通知应用到切入点的过程。</li>
<li>引入（introduction）： 引入新的类和其方法，增强现有 Bean 的功能。</li>
<li>切面（aspect）： 一个可以定义切点、各类通知和引入的内容。</li>
</ul>
<h4 id="2-2-确定连接点"><a href="#2-2-确定连接点" class="headerlink" title="2.2  确定连接点"></a>2.2  确定连接点</h4><p>代码2-1  用户服务接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.service</span><br><span class="line"><span class="keyword">import</span> com.znv.study.pojo.User</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码2-2  用户服务接口实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.service.impl</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(User == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;检查用户参数是否为空&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-开发切面"><a href="#2-3-开发切面" class="headerlink" title="2.3  开发切面"></a>2.3  开发切面</h4><p>代码2-3  定义切面和切点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span>  <span class="comment">//需要手动导入 aspectj.jar 和 aspectj-weave.jar</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span>&#123;</span><br><span class="line"> <span class="comment">//定义切点</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * @Param execution： 在执行的方法，拦截括号中正则匹配的方法</span></span><br><span class="line"><span class="comment">  * @Param *： 返回值类型</span></span><br><span class="line"><span class="comment">  * @Param ...printUser()： 方法的全限定名称</span></span><br><span class="line"><span class="comment">  * @Param .. ： 表示任意参数进行匹配</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Pointcut(&quot;execution(* com.znv.study.service.impl.UserServiceImpl.printUser(..))&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;...&#125;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-测试-AOP"><a href="#2-4-测试-AOP" class="headerlink" title="2.4  测试 AOP"></a>2.4  测试 AOP</h4><p>代码2-4  用户控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study.controller</span><br><span class="line"><span class="comment">//定义控制器</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//定义类请求路径</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line">    <span class="comment">//注入用户服务</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义请求</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/print&quot;)</span></span><br><span class="line">    <span class="comment">//转换为JSON</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">printUser</span><span class="params">(Long id, String userName, String note)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(id, userName, note);</span><br><span class="line">        userService.printUser(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码2-5  Spring Boot 配置启动文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.study</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1Application</span> &#123;</span><br><span class="line">    <span class="comment">//定义切面</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;myAspect&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MyAspect <span class="title function_">initMyAspect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyAspect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//启动切面</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Demo1Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:8080/user/print?id=1&amp;userName=username1&amp;note=232">http://localhost:8080/user/print?id=1&amp;userName=username1&amp;note=232</a>，如果显示正确的 JSON 对象，则测试通过。</p>
<h4 id="2-5-环绕通知"><a href="#2-5-环绕通知" class="headerlink" title="2.5  环绕通知"></a>2.5  环绕通知</h4><p>在代码 2-3 中加入以下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//回调目标对象的原有方法</span></span><br><span class="line">    jp.proceed();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-6-通知获取参数"><a href="#2-6-通知获取参数" class="headerlink" title="2.6  通知获取参数"></a>2.6  通知获取参数</h4><p>代码 2-6  在前置通知中获取参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;pointCut() &amp;&amp; args(user)&quot;)</span>  <span class="comment">//将连接点的名称为 user 的参数传递进来</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeWithParam</span><span class="params">(JoinPoint point, User user)</span>&#123;</span><br><span class="line">    Object[] args = point.getArgs();</span><br><span class="line">    System.out.println(before...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-7-多个切面"><a href="#2-7-多个切面" class="headerlink" title="2.7  多个切面"></a>2.7  多个切面</h4><p>定义多个切面后，只要在 Spring  Boot 配置启动文件（代码2-5）中加入以下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;myAspect1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MyAspect <span class="title function_">initMyAspect1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyAspect1</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@Bean(name = &quot;myAspect2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MyAspect <span class="title function_">initMyAspect2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyAspect2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="三、-MyBatis-操作数据库"><a href="#三、-MyBatis-操作数据库" class="headerlink" title="三、 MyBatis 操作数据库"></a>三、 MyBatis 操作数据库</h3><h4 id="3-1-配置自定义数据源"><a href="#3-1-配置自定义数据源" class="headerlink" title="3.1  配置自定义数据源"></a>3.1  配置自定义数据源</h4><ul>
<li>增加依赖（pom.xml）</li>
</ul>
<p>代码 3-1</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置数据源（application.properties）</li>
</ul>
<p>代码 3-2</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment">#*spring.datasource.driver-class-name=com.mysql.jdbcDriver*</span></span><br><span class="line"><span class="comment">#数据库连接池初始化数据库</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.initial-size</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#最大等待毫秒数，超出时间会报错</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.max-wait</span>=<span class="string">10000</span></span><br><span class="line"><span class="comment">#最大等待连接的数量，设 0 为没有限制</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.max-idle</span>=<span class="string">10</span></span><br><span class="line"><span class="comment">#最大连接活动数</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.max-active</span>=<span class="string">50</span></span><br></pre></td></tr></table></figure>

<p>注释中加 * 的地方：虽然注释了驱动类的配置，但依旧可以连接数据源，因为 Spring Boot 会尽可能地判断数据源是什么类型的，然后根据默认的情况去匹配驱动类。</p>
<h4 id="3-2-MyBatis-基础操作"><a href="#3-2-MyBatis-基础操作" class="headerlink" title="3.2  MyBatis 基础操作"></a>3.2  MyBatis 基础操作</h4><p>代码 3-3  定义 User 类 pojo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.database.demodatabase.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.Alias;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Alias(&quot;user&quot;)</span>  <span class="comment">//MyBatis指定别名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/* setters and getters */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码 3-4  定义数据持久层接口，无需实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.database.demodatabase.dao</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyBatisUserDao</span> &#123;</span><br><span class="line">    <span class="comment">//增加用户，返回增加结果，1 代表成功，其他代表失败，下同</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="comment">//删除用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="comment">//更新用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="comment">//通过用户名查找用户信息，返回符合条件的对象</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="comment">//返回所有用户的列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAllUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码 3-5  定义 MyBatis 映射配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- namespace 指定 dao 的一个接口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.znv.database.demodatabase.dao.MyBatisUserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id 指代此条 SQL，resultType 指定返回值类型 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 user 是因为在 User类中指代了别名，也可以用全限定名com.znv.database.demodatabase.pojo.User --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过 username 获取用户信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        SELECT id,username,password FROM user WHERE username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 获取所有用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO User (id,username,password) values(#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--修改用户信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user SET username=#&#123;username&#125;,password=#&#123;password&#125; WHERE id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM user WHERE username=#&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码 3-6  调用数据持久层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/dologin&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doLogin</span><span class="params">(String username, String password, Model model)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) myBatisUserDao.getUserByUsername(username);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> password.equals(user.getPassword());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;User&gt; list = (List&lt;User&gt;) myBatisUserDao.findAllUsers();</span><br><span class="line">            model.addAttribute(<span class="string">&quot;user&quot;</span>,user);  <span class="comment">//保存user，可由thymeleaf访问，下同</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;list&quot;</span>,list);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="comment">//doLogin end</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-MyBatis-进阶"><a href="#3-3-MyBatis-进阶" class="headerlink" title="3.3  MyBatis  进阶"></a>3.3  MyBatis  进阶</h4><h5 id="3-3-1-resultMap-表关联"><a href="#3-3-1-resultMap-表关联" class="headerlink" title="3.3.1  resultMap 表关联"></a>3.3.1  resultMap 表关联</h5><p>代码 3-7  创建 Post 类 pojo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.znv.database.demodatabase.pojo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Alias(&quot;post&quot;)</span>  <span class="comment">//定义 Post 别名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"> <span class="comment">/* setters and getters */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在代码 3-3 加入 Post 关联</p>
<p><code>private List&lt;Post&gt; posts;</code></p>
<p>代码 3-8  新建映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.znv.joker.userMaper&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- User 级联文章查询 方法配置 (一个用户对多个文章)  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;resultUserMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		   - id: 数据库记录的主键</span></span><br><span class="line"><span class="comment">           - result： 数据库记录的其他字段</span></span><br><span class="line"><span class="comment">           - column： 数据库记录字段名</span></span><br><span class="line"><span class="comment">           - property： bean 对象中的属性名</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;mobile&quot;</span> <span class="attr">column</span>=<span class="string">&quot;mobile&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;posts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;post&quot;</span> <span class="attr">column</span>=<span class="string">&quot;userid&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;content&quot;</span> <span class="attr">column</span>=<span class="string">&quot;content&quot;</span>/&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- resultMap 与 resultType 不可共存 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resultMap 指向对应的自定义映射规则的id --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultUserMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  SELECT u.*,p.*</span><br><span class="line">  FROM user u, post p</span><br><span class="line">  WHERE u.id=p.userid AND id=#&#123;user_id&#125; </span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- User 级联文章查询 方法配置 (多个文章对一个用户)  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">id</span>=<span class="string">&quot;resultPostsMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;post_id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;content&quot;</span> <span class="attr">column</span>=<span class="string">&quot;content&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;User&quot;</span>&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;userid&quot;</span>/&gt;</span>   </span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span>   </span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;mobile&quot;</span> <span class="attr">column</span>=<span class="string">&quot;mobile&quot;</span>/&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPosts&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultPostsMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  SELECT u.*,p.*</span><br><span class="line">  FROM user u, post p</span><br><span class="line">  WHERE u.id=p.userid AND p.post_id=#&#123;post_id&#125; </span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-3-2-动态-SQL"><a href="#3-3-2-动态-SQL" class="headerlink" title="3.3.2  动态 SQL"></a>3.3.2  动态 SQL</h5><ol>
<li><p>if 标签</p>
<p>在 if 标签中先进行判断，如果值为 null 或等于空字符串，就不在 SQL 语句中进行此条件的判断。</p>
<p>这里的 1&#x3D;1 是为了避免 if 标签都未匹配从而导致 SQL 语法错误</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;dynamicIfTest&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line"> select * from t_blog where 1=1</span><br><span class="line"> <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">  and title = #&#123;title&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;content != null&quot;</span>&gt;</span></span><br><span class="line">  and content = #&#123;content&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;owner != null&quot;</span>&gt;</span></span><br><span class="line">  and owner = #&#123;owner&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>where 标签</p>
<p>where 主要是用来简化 SQL语句中 where 条件判断，自动处理（前置）AND&#x2F;OR 条件。</p>
<p>如果将 AND&#x2F;OR 写在 if 标签中 SQL 语句后在某些情况下还是会出现语法错误。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;dynamicWhereTest&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line"> select * from t_blog </span><br><span class="line"> <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">   title = #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;content != null&quot;</span>&gt;</span></span><br><span class="line">   and content = #&#123;content&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;owner != null&quot;</span>&gt;</span></span><br><span class="line">   and owner = #&#123;owner&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>set 标签</p>
<p>set 标签元素主要用在更新操作的时候，在包含的语句前输出一个 set，然后如果包含的语句是以逗号结束的话将会把该逗号忽略，如果 set 包含的内容为空的话则会出错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;dynamicSetTest&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line"> update t_blog</span><br><span class="line"> <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;,</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;content != null&quot;</span>&gt;</span></span><br><span class="line">            content = #&#123;content&#125;,</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;owner != null&quot;</span>&gt;</span></span><br><span class="line">            owner = #&#123;owner&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"> where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>trim 标签</p>
<p>trim 是为了更灵活地去除多余关键字的标签，可以用来实现 where 和 set 的效果。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">prefix</td>
<td align="left">给sql语句拼接的前缀</td>
</tr>
<tr>
<td align="center">suffix</td>
<td align="left">给sql语句拼接的后缀</td>
</tr>
<tr>
<td align="center">prefixesToOverride</td>
<td align="left">去除sql语句前面的关键字或者字符，该关键字或者字符由prefixesToOverride属性指定，假设该属性指定为”AND”，当sql语句的开头为”AND”，trim标签将会去除该”AND”</td>
</tr>
<tr>
<td align="center">suffixesToOverride</td>
<td align="left">去除sql语句后面的关键字或者字符，该关键字或者字符由suffixesToOverride属性指定</td>
</tr>
</tbody></table>
<ul>
<li><p>使用 if&#x2F;trim 代替 where 标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用 if/trim 代替 where(判断参数) - 将 User 类不为空的属性作为 where 条件 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUsertList_if_trim&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultMap_User&quot;</span>&gt;</span>  </span><br><span class="line">    SELECT * </span><br><span class="line">      FROM user u</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixToOverride</span>=<span class="string">&quot;AND|OR&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username !=null &quot;</span>&gt;</span>  </span><br><span class="line">            u.username LIKE CONCAT(CONCAT(&#x27;%&#x27;, #&#123;username, jdbcType=VARCHAR&#125;),&#x27;%&#x27;)  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27; &quot;</span>&gt;</span>  </span><br><span class="line">            AND u.sex = #&#123;sex, jdbcType=INTEGER&#125;  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;birthday != null &quot;</span>&gt;</span>  </span><br><span class="line">            AND u.birthday = #&#123;birthday, jdbcType=DATE&#125;  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 trim 代替 set 标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- if/trim代替set(判断参数) - 将 User 类不为空的属性更新 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser_if_trim&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.yiibai.pojo.User&quot;</span>&gt;</span>  </span><br><span class="line">    UPDATE user  </span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixToOverride</span>=<span class="string">&quot;,&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27; &quot;</span>&gt;</span>  </span><br><span class="line">            username = #&#123;username&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27; &quot;</span>&gt;</span>  </span><br><span class="line">            sex = #&#123;sex&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;birthday != null &quot;</span>&gt;</span>  </span><br><span class="line">            birthday = #&#123;birthday&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span>  </span><br><span class="line">    WHERE user_id = #&#123;user_id&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>choose( when, otherwise ) 标签</p>
<p>用法与 switch 相似。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;dynamicChooseTest&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line"> select * from t_blog where 1 = 1 </span><br><span class="line"> <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            and title = #&#123;title&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;content != null&quot;</span>&gt;</span></span><br><span class="line">            and content = #&#123;content&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and owner = &quot;owner1&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="四、-Web-相关"><a href="#四、-Web-相关" class="headerlink" title="四、 Web 相关"></a>四、 Web 相关</h3><h4 id="4-1-Controller-接收参数"><a href="#4-1-Controller-接收参数" class="headerlink" title="4.1  Controller 接收参数"></a>4.1  Controller 接收参数</h4><h5 id="4-1-1-请求路径参数"><a href="#4-1-1-请求路径参数" class="headerlink" title="4.1.1  请求路径参数"></a>4.1.1  请求路径参数</h5><ol>
<li><p>@PathVariable</p>
<p>获取路径参数。即 *url&#x2F;{id}*的形式。</p>
</li>
<li><p>@RequestParam</p>
<p>获取查询参数。即 <em>url?username&#x3D;xxx&amp;age&#x3D;xx</em> 的 形式。</p>
</li>
</ol>
<p>代码 4-1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//url: 127.0.0.1:8080/demo/123?username=hah</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;demo/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(<span class="meta">@PathVariable(name=&quot;id&quot;)</span> String id,</span></span><br><span class="line"><span class="params">                 <span class="meta">@RequestParam(name=&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;id: &quot;</span> + id);  <span class="comment">//id: 123</span></span><br><span class="line">    System.out.println(<span class="string">&quot;username: &quot;</span> + username);  <span class="comment">//username: hah</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-1-2-Body-参数"><a href="#4-1-2-Body-参数" class="headerlink" title="4.1.2  Body 参数"></a>4.1.2  Body 参数</h5><ol>
<li><p>@RequestBody</p>
<p>url:  127.0.0.1:8080&#x2F;demo1</p>
<p>body:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;joker&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>代码 4-2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demo1</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    System.out.println(user.toString());  <span class="comment">//User[id=1,username=&quot;joker&quot;,password=&quot;123&quot;]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(path = &quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demo1</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, Object&gt; user)</span> &#123;</span><br><span class="line">    System.out.println(person.get(<span class="string">&quot;username&quot;</span>));  <span class="comment">//joker</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="4-1-3-请求头参数及-Cookie"><a href="#4-1-3-请求头参数及-Cookie" class="headerlink" title="4.1.3  请求头参数及 Cookie"></a>4.1.3  请求头参数及 Cookie</h5><ol>
<li><p>@RequestHeader</p>
</li>
<li><p>@CookieValue</p>
<p>代码 4-3</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demo3</span><span class="params">(<span class="meta">@RequestHeader(name = &quot;myHeader&quot;)</span> String myHeader,</span></span><br><span class="line"><span class="params">        <span class="meta">@CookieValue(name = &quot;myCookie&quot;)</span> String myCookie)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;myHeader=&quot;</span> + myHeader);</span><br><span class="line">    System.out.println(<span class="string">&quot;myCookie=&quot;</span> + myCookie);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demo3</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    System.out.println(request.getHeader(<span class="string">&quot;myHeader&quot;</span>));</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;myCookie&quot;</span>.equals(cookie.getName())) &#123;</span><br><span class="line">            System.out.println(cookie.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="4-2-返回-JSON-数据格式"><a href="#4-2-返回-JSON-数据格式" class="headerlink" title="4.2  返回 JSON 数据格式"></a>4.2  返回 JSON 数据格式</h4><h5 id="4-2-1-通过-ResponseBody"><a href="#4-2-1-通过-ResponseBody" class="headerlink" title="4.2.1  通过@ResponseBody"></a>4.2.1  通过@ResponseBody</h5><p>通过@ResponseBody 方式，需要在@RequestMapping 中，添加<code>produces = &quot;application/json;charset=UTF-8&quot;</code>,设定返回值的类型。</p>
<p>先导入 net.sf.json-lib 的依赖</p>
<p>代码 4-4</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.json-lib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>jdk15<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.znv.database.demodatabase.dao.MyBatisUserDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/insert&quot;, produces = &quot;application/json;charset=UTF-8&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">insertUser</span><span class="params">(<span class="type">int</span> id, String username, String password)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(id, username, password);</span><br><span class="line">        <span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> myBatisUserDao.insertUser(user);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        result.put(<span class="string">&quot;success&quot;</span>,flag);</span><br><span class="line">        <span class="keyword">return</span> result.toString();  <span class="comment">//插入成功后会向客户端返回 &#123; &quot;success&quot;: 1 &#125;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-2-2-通过HttpServletResponse来返回"><a href="#4-2-2-通过HttpServletResponse来返回" class="headerlink" title="4.2.2  通过HttpServletResponse来返回"></a>4.2.2  通过HttpServletResponse来返回</h5><p>通过HttpServletResponse 获取到输出流后，写出数据到客户端。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/resp/data&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeByResp</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam,HttpServletResponse resp)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将获取的json数据封装一层，然后在给返回</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    result.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    result.put(<span class="string">&quot;method&quot;</span>, <span class="string">&quot;HttpServletResponse&quot;</span>);</span><br><span class="line">    result.put(<span class="string">&quot;data&quot;</span>, jsonParam);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写json数据到客户端</span></span><br><span class="line">    <span class="built_in">this</span>.writeJson(resp, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeJson</span><span class="params">(HttpServletResponse resp ,JSONObject json )</span>&#123;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//设定类容为json的格式</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        out = resp.getWriter();</span><br><span class="line">        <span class="comment">//写到客户端</span></span><br><span class="line">        out.write(json.toJSONString());</span><br><span class="line">        out.flush();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(out != <span class="literal">null</span>)&#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                </section>

                
                

                

            </article>

            
            <nav class="dis_flex al_post_nav">
                <a class="al_post_nav_item dis_flex_acenter" href="/2020/10/27/%E5%9B%BE%E8%A7%A3HTTP/">
                    
                        <svg class="al_arrow">
                            <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-arrow-left"></use>
                        </svg>
                        <span class="al_text_ellipsis al_post_nav_desc">《图解HTTP》笔记</span>
                    
                </a>
                <a class="al_post_nav_item dis_flex_acenter" href="/">
                    
                </a>
            </nav>
        </div>
    </div>


        <div class="al_index_footer dis_flex_center">
    <div class="al_index_footer_item al_index_footer_title">
        Joker Won
    </div>

    
    

    <div class="al_index_footer_item al_index_footer_extra">
        Created By 
        <a target="_blank" rel="noopener" href="https://github.com/iGuan7u/Acetolog">AcetoLog</a>
         · Power By 
        <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
    </div>

    <div class="al_index_footer_item al_index_footer_extra_right">
        All Right Reserved
    </div>
</div>

        <script type="text/javascript" async="async" src="/javascripts/acelog.js"></script>
        
        
        
        
        

    </body>
</html>